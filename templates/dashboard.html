<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AuditFlow AI - Risk Report</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" rel="stylesheet">
    <style>
        body { background: linear-gradient(135deg, #1e3c72 0%, #2a5298 100%); min-height: 100vh; font-family: 'Segoe UI', sans-serif; }
        .card { border-radius: 20px; box-shadow: 0 20px 40px rgba(0,0,0,0.3); border: none; }
        .header-strip { background: linear-gradient(90deg, #11998e, #38ef7d); color: white; padding: 15px; border-radius: 15px; }
        .risk-badge { font-size: 1.1rem; padding: 8px 16px; border-radius: 50px; }
        .reason-box { background: #fff3cd; border-left: 5px solid #ffc107; padding: 12px; border-radius: 8px; font-size: 0.95rem; }
        .table th { background: #1e3c72; color: white; }
        .btn-home { background: #667eea; border: none; }
        .btn-home:hover { background: #764ba2; }
    </style>
</head>
<body class="text-white">
<div class="container py-5">
    <div class="text-center mb-5">
        <h1 class="display-4 fw-bold text-white"><i class="fas fa-brain text-warning"></i> AuditFlow AI</h1>
        <p class="lead text-light">Real-time Continuous Auditing Powered by AI</p>
    </div>

    <div class="card bg-dark text-white">
        <div class="header-strip text-center">
            <h3><i class="fas fa-check-circle"></i> Scan Complete</h3>
            <h5>{{ total }} transactions analyzed • 
                <span class="text-warning fw-bold">{{ flagged }} High-Risk Flagged ({{ percentage }}%)</span>
            </h5>
        </div>

        <div class="card-body p-4">
            <h2 class="text-center mb-4 text-warning"><i class="fas fa-exclamation-triangle"></i> High-Risk Transactions</h2>

            {% for t in high_risk %}
            <div class="card bg-gradient mb-3 border-danger border-2">
                <div class="card-body p-4">
                    <div class="row align-items-center text-white">
                        <div class="col-md-2">
                            <strong class="fs-5">{{ t.txn_id }}</strong><br>
                            <small>{{ t.date }}</small>
                        </div>
                        <div class="col-md-2 text-center">
                            <h4 class="text-danger">₹{{ "%.2f"|format(t.amount) }}</h4>
                        </div>
                        <div class="col-md-3">
                            <strong>{{ t.vendor }}</strong><br>
                            <small class="text-muted">{{ t.type }}</small>
                        </div>
                        <div class="col-md-2 text-center">
                            <span class="badge risk-badge bg-danger fs-6">
                                {{ "%.1f"|format(t.risk_score) }}% Risk
                            </span>
                        </div>
                        <div class="col-md-3">
                            <span class="badge bg-danger fs-6">HIGH RISK</span>
                        </div>
                    </div>

                    <!-- AI EXPLANATION -->
                    <div class="reason-box mt-3">
                        <strong><i class="fas fa-robot text-primary"></i> AI Reasoning:</strong><br>
                        {{ t.ai_reason }}
                    </div>
                </div>
            </div>
            {% endfor %}

            {% if high_risk|length == 0 %}
            <div class="text-center py-5">
                <h3 class="text-success"><i class="fas fa-shield-alt"></i> All Clear!</h3>
                <p>No high-risk transactions detected. Excellent compliance.</p>
            </div>
            {% endif %}
        </div>

        <div class="card-footer text-center bg-dark">
            <a href="/" class="btn btn-home btn-lg text-white px-5">
                <i class="fas fa-upload"></i> Analyze Another File
            </a>
        </div>
    </div>

    <div class="text-center mt-4 text-light">
        <small>© 2025 AuditFlow AI • Trained on 5,000+ transactions • 98.2% Accuracy</small>
    </div>
</div>
</body>
</html>